# GithubActionså’Œvuepress

æœ¬ç«™ç‚¹ä½¿ç”¨`Vuepress`ï¼Œæˆ‘å¸Œæœ›ä½¿ç”¨æ¯æ¬¡æ¨é€æ—¶è‡ªåŠ¨æ„å»ºç›®å½•å¹¶è¿›è¡Œéƒ¨ç½²ã€‚

## æœŸæœ›çš„æ•ˆæœ

æœ¬åœ°å®Œæˆæ–‡æ¡£å¹¶æäº¤ï¼Œæ¨é€å github è‡ªåŠ¨è§¦å‘æ„å»ºåŠéƒ¨ç½²

å¯ä»¥æ ¹æ®æäº¤ä¿¡æ¯ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„å‘½ä»¤ï¼Œå¦‚`:rocket:`æ¥ç¡®å®šæ˜¯å¦éœ€è¦ç»§ç»­æ‰§è¡Œæ„å»ºåŠéƒ¨ç½²

## å®ç°æ­¥éª¤

æ„å»ºæ€è·¯ï¼šè·å–ä»£ç ã€è®¾ç½® node ç¯å¢ƒã€å®‰è£…ä¾èµ–ã€æ‰§è¡Œæ„å»º`npm run build`ã€æ¨é€`dist`åˆ°`gh-page`åˆ†æ”¯ã€‚

### æ„å»ºéƒ¨ç½²

1. æ–°å»ºå·¥ä½œæµ workflowï¼Œå³åœ¨ä»“åº“ä¸‹å»ºç«‹ä¸€ä¸ª git actions æ–‡ä»¶ï¼š`.github/workflows/demo.yml`
2. æŒ‡å®šå·¥ä½œæµåç§°ã€åˆ†æ”¯ç­‰ï¼Œè¿™é‡Œä½¿ç”¨ master åˆ†æ”¯ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ–°æ¨é€éƒ½ä¼šè°ƒç”¨èµ· actionsï¼Œå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®ä¸åŒåˆ†æ”¯
    ```yml
    name: VuePress
    on:
        push:
            branches:
                - master
    ```
3. ä½¿ç”¨å®˜æ–¹`action`æ£€å‡ºä»£ç 
    ```yml
    - name: Checkout
      uses: actions/checkout@v2.4.0
    ```
4. ä½¿ç”¨å®˜æ–¹`action`é…ç½® node ç¯å¢ƒ
    ```yml
    - name: Setup Node.js env
      uses: actions/setup-node@v2
      with:
        node-version: '14'
        cache: 'npm' # use cache.
    ```
5. å®‰è£…ä¾èµ–ä»¥åŠæ‰§è¡Œæ„å»º
    ```yml
    - name: install dep and build
      run: |
        npm install
        npm run build
    ```
6. ä½¿ç”¨ä¸‰æ–¹`action`æ‰§è¡Œå‘å¸ƒæ“ä½œï¼ˆé»˜è®¤ä¼šå‘å¸ƒåˆ°å½“å‰ä»“åº“çš„å¯¹åº”åˆ†æ”¯ï¼‰ï¼Œå¦‚æœéœ€è¦å‘å¸ƒåˆ°å…¶ä»–ä»“åº“ç­‰ï¼Œéœ€è¦é…ç½®`access_token`
    ```yml
    - uses: JamesIves/github-pages-deploy-action@4.1.7
      with:
        branch: gh-pages
        folder: dist # é»˜è®¤çš„æ„å»ºåè¾“å‡ºç›®å½•
    ```

## æ ¹æ®æäº¤å†…å®¹å†³å®šæ˜¯å¦æ„å»º

åˆ¤æ–­æµç¨‹ï¼šæŠ“å–ä»£ç ->å–å‡ºæœ€è¿‘ä¸€æ¬¡æäº¤->åˆ¤æ–­æ˜¯å¦æœ‰éœ€è¦æ„å»ºçš„æ ‡å¿—ã€‚

å‡è®¾çº¦å®šå½“æäº¤ä¿¡æ¯ä»¥`:rocket:`å¼€å¤´æ—¶ï¼Œæ‰§è¡Œæ„å»ºã€‚ä¸»è¦éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š    

1. è·å–æœ€æ–°æäº¤çš„é¦–ä¸ªå•è¯
2. åˆ¤æ–­æ‰€è·å–å•è¯æ˜¯å¦ä¸º`:rocket:`

### è·å–æœ€æ–°æäº¤çš„é¦–ä¸ªå•è¯

åœ¨æ­¥éª¤ä¸­æ‰§è¡Œï¼š`git log -1 --pretty='%s' | cut -f1 -d ' '`å¯ä»¥è·å–æäº¤çš„é¦–ä¸ªå•è¯

ä½†æ˜¯å¦‚ä½•åœ¨å…¶ä»–æ­¥éª¤ä¸­è·å–æäº¤çš„é¦–ä¸ªå•è¯æ¥åˆ¤æ–­æ˜¯å¦ç¬¦åˆè¦æ±‚å‘¢ï¼Ÿ

è¿™é‡Œä½¿ç”¨`steps.ouputs`æ¥è¾¾åˆ°è¯¥ç›®çš„ï¼šåœ¨æ­¥éª¤(`step_judge`)ä¸­è·å–æœ€è¿‘æäº¤çš„é¦–ä¸ªå•è¯ï¼Œå¹¶ä½œä¸ºè¯¥æ­¥éª¤çš„è¾“å‡ºï¼Œä¹‹åçš„æ­¥éª¤å¯ä»¥é€šè¿‡å¼•ç”¨è¯¥æ­¥éª¤`step_judge`çš„è¾“å‡ºå˜é‡æ¥åˆ¤æ–­æ˜¯å¦ç¬¦åˆè¦æ±‚ã€‚

step å…·ä½“é…ç½®ï¼š

```yml
- name: judge_buildornot
  id: step_judge
  run: echo "::set-output name=needbuild::$(git log -1 --pretty='%s' | cut -f1 -d ' ')"
```

### åˆ¤æ–­æ‰€è·å–å•è¯

ä½¿ç”¨ Github Actions ä¸­ `step.if` æ¥åˆ¤æ–­æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œä»¥åŠå†³å®šæ˜¯å¦æ‰§è¡Œå¯¹åº”çš„æ­¥éª¤ï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š

```yml
- name: build
  if: steps.judge_buildornot.outputs.needbuild == ':rocket:'
  run: |
    npm install
    npm run build
```

[ğŸ‘‰è¿™é‡Œæ˜¯](https://raw.githubusercontent.com/smart-town/smart-town.github.io/master/.github/workflows/first.yml)ä¸€ä»½æ ¹æ®æäº¤ä¿¡æ¯æ˜¯å¦æ˜¯ä»¥`:rocket:`å¼€å¤´æ¥å†³å®šæ˜¯å¦æ„å»ºçš„ç®€å•å·¥ä½œæµã€‚